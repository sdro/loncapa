(function(){function f(){this.operators=[]}f.ARG_SEPARATOR=";";f.DECIMAL_SIGN_1=".";f.DECIMAL_SIGN_2=",";f.prototype.operator=function(n,l,k,j,i,m){this.operators.push(new d(n,l,k,j,i,m))};f.prototype.separator=function(i){this.operator(i,d.BINARY,0,0,null,null)};f.prototype.infix=function(n,k,j,m){var l,i;l=d.BINARY;i=null;m=m||function(r,q){var o=[q,r.expression(j)];return new h(h.OPERATOR,this,n,o)};this.operator(n,l,k,j,i,m)};f.prototype.prefix=function(n,j,i){var l,k,m;l=d.UNARY;k=0;i=i||function(q){var o=[q.expression(j)];return new h(h.OPERATOR,this,n,o)};m=null;this.operator(n,l,k,j,i,m)};f.prototype.suffix=function(n,k,m){var l,j,i;l=d.UNARY;j=0;i=null;m=m||function(r,q){var o=[q];return new h(h.OPERATOR,this,n,o)};this.operator(n,l,k,j,i,m)};f.prototype.findOperator=function(k){for(var j=0;j<this.operators.length;j++){if(this.operators[j].id==k){return(this.operators[j])}}return null};f.prototype.define=function(){this.suffix("!",160);this.infix("^",140,139);this.infix(".",130,129);this.infix("`",125,125,function(r,q){var o=r.expression(125);while(r.current_token!=null&&"*/".indexOf(r.current_token.value)!=-1&&r.tokens[r.token_nr]!=null&&(r.tokens[r.token_nr].type==g.NAME||r.tokens[r.token_nr].value=="(")&&(r.tokens[r.token_nr+1]==null||r.tokens[r.token_nr+1].value!="(")){if(r.unit_mode){var j=r.tokens[r.token_nr].value;var k=false;for(var n=0;n<r.constants.length;n++){if(j==r.constants[n]){k=true;break}}if(k){break}}var m=r.current_token;r.advance();o=m.op.led(r,o)}var l=[q,o];return new h(h.OPERATOR,this,"`",l)});this.infix("*",120,120);this.infix("/",120,120);this.infix("+",100,100);this.operator("-",d.BINARY,100,134,function(j){var i=[j.expression(134)];return new h(h.OPERATOR,this,"-",i)},function(k,j){var i=[j,k.expression(100)];return new h(h.OPERATOR,this,"-",i)});this.infix("=",80,80);this.infix("#",80,80);this.infix("<=",80,80);this.infix(">=",80,80);this.infix("<",80,80);this.infix(">",80,80);this.separator(")");this.separator(f.ARG_SEPARATOR);this.operator("(",d.BINARY,200,200,function(j){var i=j.expression(0);j.advance(")");return i},function(k,j){if(j.type!=h.NAME&&j.type!=h.SUBSCRIPT){throw new a("Function name expected before a parenthesis.",k.tokens[k.token_nr-1].from)}var i=[j];if(k.current_token==null||k.current_token.op==null||k.current_token.op.id!==")"){while(true){i.push(k.expression(0));if(k.current_token==null||k.current_token.op==null||k.current_token.op.id!==f.ARG_SEPARATOR){break}k.advance(f.ARG_SEPARATOR)}}k.advance(")");return new h(h.FUNCTION,this,"(",i)});this.separator("]");this.operator("[",d.BINARY,200,70,function(j){var i=[];if(j.current_token==null||j.current_token.op==null||j.current_token.op.id!=="]"){while(true){i.push(j.expression(0));if(j.current_token==null||j.current_token.op==null||j.current_token.op.id!==f.ARG_SEPARATOR){break}j.advance(f.ARG_SEPARATOR)}}j.advance("]");return new h(h.VECTOR,this,null,i)},function(k,j){if(j.type!=h.NAME&&j.type!=h.SUBSCRIPT){throw new a("Name expected before a square bracket.",k.tokens[k.token_nr-1].from)}var i=[j];if(k.current_token==null||k.current_token.op==null||k.current_token.op.id!=="]"){while(true){i.push(k.expression(0));if(k.current_token==null||k.current_token.op==null||k.current_token.op.id!==f.ARG_SEPARATOR){break}k.advance(f.ARG_SEPARATOR)}}k.advance("]");return new h(h.SUBSCRIPT,this,"[",i)})};function h(j,l,k,i){this.type=j;this.op=l;this.value=k;this.children=i}h.UNKNOWN=0;h.NAME=1;h.NUMBER=2;h.OPERATOR=3;h.FUNCTION=4;h.VECTOR=5;h.SUBSCRIPT=6;h.COLORS=["#E01010","#0010FF","#009000","#FF00FF","#00B0B0","#F09000","#800080","#F080A0","#6090F0","#902000","#70A050","#A07060","#5000FF","#E06050","#008080","#808000"];h.prototype.toString=function(){var k="(";switch(this.type){case h.UNKNOWN:k+="UNKNOWN";break;case h.NAME:k+="NAME";break;case h.NUMBER:k+="NUMBER";break;case h.OPERATOR:k+="OPERATOR";break;case h.FUNCTION:k+="FUNCTION";break;case h.VECTOR:k+="VECTOR";break;case h.SUBSCRIPT:k+="SUBSCRIPT";break}if(this.op){k+=" '"+this.op.id+"'"}if(this.value){k+=" '"+this.value+"'"}if(this.children){k+=" [";for(var j=0;j<this.children.length;j++){k+=this.children[j].toString();if(j!=this.children.length-1){k+=","}}k+="]"}k+=")";return k};h.prototype.getColorForIdentifier=function(i,k){var j=k[i];if(!j){j=h.COLORS[Object.keys(k).length%h.COLORS.length];k[i]=j}return j};h.prototype.toMathML=function(m){var H,G,D,C,B,K,I,l,y,z,J,p,w,A,r;if(typeof m=="undefined"){m={hcolors:{},depth:0}}if(this.children!=null&&this.children.length>0){H=this.children[0]}else{H=null}if(this.children!=null&&this.children.length>1){G=this.children[1]}else{G=null}if(this.children!=null&&this.children.length>2){D=this.children[2]}else{D=null}if(this.children!=null&&this.children.length>3){C=this.children[3]}else{C=null}if(this.children!=null&&this.children.length>4){B=this.children[4]}else{B=null}switch(this.type){case h.UNKNOWN:l=document.createElement("mtext");l.appendChild(document.createTextNode("???"));return(l);case h.NAME:if(this.value.search(/^[a-zA-Z]+[0-9]+$/)>=0){var v=this.value.search(/[0-9]/);A=document.createElement("msub");A.appendChild(this.mi(this.value.substring(0,v)));A.appendChild(this.mn(this.value.substring(v)));l=A}else{l=this.mi(this.value)}l.setAttribute("mathcolor",this.getColorForIdentifier(this.value,m.hcolors));return(l);case h.NUMBER:if(this.value.indexOf("e")!=-1||this.value.indexOf("E")!=-1){var t=this.value.indexOf("e");if(t==-1){t=this.value.indexOf("E")}z=document.createElement("mrow");z.appendChild(this.mn(this.value.substring(0,t)));z.appendChild(this.mo("\u22C5"));r=document.createElement("msup");r.appendChild(this.mn(10));r.appendChild(this.mn(this.value.substring(t+1)));z.appendChild(r);return(z)}return(this.mn(this.value));case h.OPERATOR:if(this.value=="/"){w=document.createElement("mfrac");w.appendChild(H.toMathML(m));w.appendChild(G.toMathML(m));l=w}else{if(this.value=="^"){if(H.type==h.FUNCTION){if(H.value=="sqrt"||H.value=="abs"||H.value=="matrix"||H.value=="diff"){y=false}else{y=true}}else{if(H.type==h.OPERATOR){y=true}else{y=false}}l=document.createElement("msup");if(y){l.appendChild(this.addP(H,m))}else{l.appendChild(H.toMathML(m))}l.appendChild(G.toMathML(m))}else{if(this.value=="*"){z=document.createElement("mrow");if(H.type==h.OPERATOR&&(H.value=="+"||H.value=="-")){z.appendChild(this.addP(H,m))}else{z.appendChild(H.toMathML(m))}var L=G;while(L.type==h.OPERATOR){L=L.children[0]}if(L.type==h.NUMBER){z.appendChild(this.mo("\u22C5"))}if(G.type==h.OPERATOR&&(G.value=="+"||G.value=="-")){z.appendChild(this.addP(G,m))}else{z.appendChild(G.toMathML(m))}l=z}else{if(this.value=="-"){z=document.createElement("mrow");if(this.children.length==1){z.appendChild(this.mo("-"));z.appendChild(H.toMathML(m))}else{z.appendChild(H.toMathML(m));z.appendChild(this.mo("-"));if(G.type==h.OPERATOR&&(G.value=="+"||G.value=="-")){z.appendChild(this.addP(G,m))}else{z.appendChild(G.toMathML(m))}}l=z}else{if(this.value=="!"){z=document.createElement("mrow");J=this.mo(this.value);if(H.type==h.OPERATOR&&(H.value=="+"||H.value=="-")){z.appendChild(this.addP(H,m))}else{z.appendChild(H.toMathML(m))}z.appendChild(J);l=z}else{if(this.value=="+"){z=document.createElement("mrow");J=this.mo(this.value);z.appendChild(H.toMathML(m));z.appendChild(J);y=false;var s=G;while(s.type==h.OPERATOR){if(s.value=="-"&&s.children.length==1){y=true;break}else{if(s.value=="+"||s.value=="-"||s.value=="*"){s=s.children[0]}else{break}}}if(y){z.appendChild(this.addP(G,m))}else{z.appendChild(G.toMathML(m))}l=z}else{if(this.value=="."){z=document.createElement("mrow");if(H.type==h.OPERATOR&&(H.value=="+"||H.value=="-")){z.appendChild(this.addP(H,m))}else{z.appendChild(H.toMathML(m))}z.appendChild(this.mo("\u22C5"));if(G.type==h.OPERATOR&&(G.value=="+"||G.value=="-")){z.appendChild(this.addP(G,m))}else{z.appendChild(G.toMathML(m))}l=z}else{if(this.value=="`"){z=document.createElement("mrow");if(H.type==h.OPERATOR&&(H.value=="+"||H.value=="-")){z.appendChild(this.addP(H,m))}else{z.appendChild(H.toMathML(m))}var n=document.createElement("mstyle");n.setAttribute("fontstyle","normal");if(G.type==h.OPERATOR&&(G.value=="+"||G.value=="-")){n.appendChild(this.addP(G,m))}else{n.appendChild(G.toMathML(m))}z.appendChild(n);l=z}else{z=document.createElement("mrow");J=this.mo(this.value);z.appendChild(H.toMathML(m));z.appendChild(J);z.appendChild(G.toMathML(m));l=z}}}}}}}}return(l);case h.FUNCTION:if(H.value=="sqrt"&&G!=null){l=document.createElement("msqrt");l.appendChild(G.toMathML(m))}else{if(H.value=="abs"&&G!=null){z=document.createElement("mrow");z.appendChild(this.mo("|"));z.appendChild(G.toMathML(m));z.appendChild(this.mo("|"));l=z}else{if(H.value=="exp"&&G!=null){l=document.createElement("msup");l.appendChild(this.mi("e"));l.appendChild(G.toMathML(m))}else{if(H.value=="factorial"){z=document.createElement("mrow");J=this.mo("!");if(G.type==h.OPERATOR&&(G.value=="+"||G.value=="-")){z.appendChild(this.addP(G,m))}else{z.appendChild(G.toMathML(m))}z.appendChild(J);l=z}else{if(H.value=="diff"&&this.children!=null&&this.children.length==3){z=document.createElement("mrow");w=document.createElement("mfrac");w.appendChild(this.mi("d"));var F=document.createElement("mrow");F.appendChild(this.mi("d"));F.appendChild(this.mi(D.value));w.appendChild(F);z.appendChild(w);if(G.type==h.OPERATOR&&(G.value=="+"||G.value=="-")){z.appendChild(this.addP(G,m))}else{z.appendChild(G.toMathML(m))}l=z}else{if(H.value=="diff"&&this.children!=null&&this.children.length==4){z=document.createElement("mrow");w=document.createElement("mfrac");r=document.createElement("msup");r.appendChild(this.mi("d"));r.appendChild(C.toMathML(m));w.appendChild(r);var F=document.createElement("mrow");F.appendChild(this.mi("d"));r=document.createElement("msup");r.appendChild(D.toMathML(m));r.appendChild(C.toMathML(m));F.appendChild(r);w.appendChild(F);z.appendChild(w);if(G.type==h.OPERATOR&&(G.value=="+"||G.value=="-")){z.appendChild(this.addP(G,m))}else{z.appendChild(G.toMathML(m))}l=z}else{if(H.value=="integrate"&&this.children!=null&&this.children.length==3){z=document.createElement("mrow");var J=this.mo("\u222B");J.setAttribute("stretchy","true");z.appendChild(J);if(D.type==h.OPERATOR&&(D.value=="+"||D.value=="-")){z.appendChild(this.addP(G,m))}else{z.appendChild(G.toMathML(m))}z.appendChild(this.mi("d"));z.appendChild(D.toMathML(m));l=z}else{if(H.value=="integrate"&&this.children!=null&&this.children.length==5){z=document.createElement("mrow");var x=document.createElement("msubsup");var J=this.mo("\u222B");J.setAttribute("stretchy","true");x.appendChild(J);x.appendChild(C.toMathML(m));x.appendChild(B.toMathML(m));z.appendChild(x);if(D.type==h.OPERATOR&&(D.value=="+"||D.value=="-")){z.appendChild(this.addP(G,m))}else{z.appendChild(G.toMathML(m))}z.appendChild(this.mi("d"));z.appendChild(D.toMathML(m));l=z}else{if(H.value=="sum"&&this.children!=null&&this.children.length==5){z=document.createElement("mrow");var q=document.createElement("munderover");var J=this.mo("\u2211");J.setAttribute("stretchy","true");q.appendChild(J);var k=document.createElement("mrow");k.appendChild(D.toMathML(m));k.appendChild(this.mo("="));k.appendChild(C.toMathML(m));q.appendChild(k);q.appendChild(B.toMathML(m));z.appendChild(q);if(D.type==h.OPERATOR&&(D.value=="+"||D.value=="-")){z.appendChild(this.addP(G,m))}else{z.appendChild(G.toMathML(m))}l=z}else{if(H.value=="product"&&this.children!=null&&this.children.length==5){z=document.createElement("mrow");var q=document.createElement("munderover");var J=this.mo("\u220F");J.setAttribute("stretchy","true");q.appendChild(J);var k=document.createElement("mrow");k.appendChild(D.toMathML(m));k.appendChild(this.mo("="));k.appendChild(C.toMathML(m));q.appendChild(k);q.appendChild(B.toMathML(m));z.appendChild(q);if(D.type==h.OPERATOR&&(D.value=="+"||D.value=="-")){z.appendChild(this.addP(G,m))}else{z.appendChild(G.toMathML(m))}l=z}else{if(H.value=="limit"){z=document.createElement("mrow");if(this.children.length<4){z.appendChild(this.mo("lim"))}else{var o=document.createElement("munder");o.appendChild(this.mo("lim"));var E=document.createElement("mrow");E.appendChild(D.toMathML(m));E.appendChild(this.mo("\u2192"));E.appendChild(C.toMathML(m));if(B!=null){if(B.value=="plus"){E.appendChild(this.mo("+"))}else{if(B.value=="minus"){E.appendChild(this.mo("-"))}}}o.appendChild(E);z.appendChild(o)}z.appendChild(G.toMathML(m));l=z}else{if(H.value=="binomial"){z=document.createElement("mrow");z.appendChild(this.mo("("));p=document.createElement("mtable");for(K=1;K<this.children.length;K++){var u=document.createElement("mtr");u.appendChild(this.children[K].toMathML(m));p.appendChild(u)}z.appendChild(p);z.appendChild(this.mo(")"));l=z}else{if(H.value=="matrix"){for(K=1;K<this.children.length;K++){if(this.children[K].type!==h.VECTOR){l=document.createElement("mtext");l.appendChild(document.createTextNode("???"));return(l)}}z=document.createElement("mrow");z.appendChild(this.mo("("));p=document.createElement("mtable");for(K=1;K<this.children.length;K++){var u=document.createElement("mtr");for(I=0;I<this.children[K].children.length;I++){u.appendChild(this.children[K].children[I].toMathML(m))}p.appendChild(u)}z.appendChild(p);z.appendChild(this.mo(")"));l=z}else{z=document.createElement("mrow");z.appendChild(H.toMathML(m));z.appendChild(this.mo("("));for(K=1;K<this.children.length;K++){z.appendChild(this.children[K].toMathML(m));if(K<this.children.length-1){z.appendChild(this.mo(f.ARG_SEPARATOR))}}z.appendChild(this.mo(")"));l=z}}}}}}}}}}}}}return(l);case h.VECTOR:z=document.createElement("mrow");z.appendChild(this.mo("("));p=document.createElement("mtable");for(K=0;K<this.children.length;K++){var u=document.createElement("mtr");u.appendChild(this.children[K].toMathML(m));p.appendChild(u)}z.appendChild(p);z.appendChild(this.mo(")"));return(z);case h.SUBSCRIPT:A=document.createElement("msub");A.appendChild(H.toMathML(m));if(this.children.length>2){z=document.createElement("mrow");for(K=1;K<this.children.length;K++){z.appendChild(this.children[K].toMathML(m));if(K<this.children.length-1){z.appendChild(this.mo(f.ARG_SEPARATOR))}}A.appendChild(z)}else{A.appendChild(G.toMathML(m))}return(A)}};h.prototype.mi=function(j){var i=document.createElement("mi");if(h.symbols[j]){j=h.symbols[j]}i.appendChild(document.createTextNode(j));return i};h.prototype.mn=function(j){var i=document.createElement("mn");i.appendChild(document.createTextNode(j));return i};h.prototype.mo=function(i){var j=document.createElement("mo");if(h.symbols[i]){i=h.symbols[i]}j.appendChild(document.createTextNode(i));return j};h.prototype.addP=function(j,k){var i,l;i=document.createElement("mrow");l=this.mo("(");l.setAttribute("mathcolor",h.COLORS[k.depth%h.COLORS.length]);i.appendChild(l);k.depth++;i.appendChild(j.toMathML(k));k.depth--;l=this.mo(")");l.setAttribute("mathcolor",h.COLORS[k.depth%h.COLORS.length]);i.appendChild(l);return i};h.symbols={alpha:"\u03B1",beta:"\u03B2",gamma:"\u03B3",delta:"\u03B4",epsilon:"\u03B5",zeta:"\u03B6",eta:"\u03B7",theta:"\u03B8",iota:"\u03B9",kappa:"\u03BA",lambda:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",omicron:"\u03BF",pi:"\u03C0",rho:"\u03C1",sigma:"\u03C3",tau:"\u03C4",upsilon:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",omega:"\u03C9",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039A",Lambda:"\u039B",Mu:"\u039C",Nu:"\u039D",Xi:"\u039E",Omicron:"\u039F",Pi:"\u03A0",Rho:"\u03A1",Sigma:"\u03A3",Tau:"\u03A4",Upsilon:"\u03A5",Phi:"\u03A6",Chi:"\u03A7",Psi:"\u03A8",Omega:"\u03A9","#":"\u2260",">=":"\u2265","<=":"\u2264",inf:"\u221E",minf:"-\u221E"};function d(n,l,k,j,i,m){this.id=n;this.arity=l;this.lbp=k;this.rbp=j;this.nud=i;this.led=m}d.UNKNOWN=0;d.UNARY=1;d.BINARY=2;d.TERNARY=3;function a(i,k,j){this.msg=i;this.from=k;if(j){this.to=j}else{this.to=this.from}}a.prototype.toString=function(){return(this.msg+" at "+this.from+" - "+this.to)};function e(m,j,l){if(typeof m=="undefined"){this.accept_bad_syntax=false}else{this.accept_bad_syntax=m}if(typeof j=="undefined"){this.unit_mode=false}else{this.unit_mode=j}if(typeof l=="undefined"){this.constants=[]}else{this.constants=l}this.defs=new f();this.defs.define();this.operators=this.defs.operators;this.oph={};for(var k=0;k<this.operators.length;k++){this.oph[this.operators[k].id]=this.operators[k]}}e.prototype.expression=function(i){var k;var j=this.current_token;if(j==null){throw new a("Expected something at the end",this.tokens[this.tokens.length-1].to+1)}this.advance();if(j.op==null){k=new h(j.type,null,j.value,null)}else{if(j.op.nud==null){throw new a("Unexpected operator '"+j.op.id+"'",j.from)}else{k=j.op.nud(this)}}while(this.current_token!=null&&this.current_token.op!=null&&i<this.current_token.op.lbp){j=this.current_token;this.advance();k=j.op.led(this,k)}return k};e.prototype.advance=function(i){if(i&&(this.current_token==null||this.current_token.op==null||this.current_token.op.id!==i)){if(this.current_token==null){throw new a("Expected '"+i+"' at the end",this.tokens[this.tokens.length-1].to+1)}else{throw new a("Expected '"+i+"'",this.current_token.from)}}if(this.token_nr>=this.tokens.length){this.current_token=null;return}this.current_token=this.tokens[this.token_nr];this.token_nr+=1};e.prototype.addHiddenOperators=function(){var w=this.defs.findOperator("*");var q=this.defs.findOperator("`");var p=false;var k=false;for(var o=0;o<this.tokens.length-1;o++){var l=this.tokens[o];var s=this.tokens[o+1];if(this.unit_mode){if(l.value=="`"){p=true}else{if(p){if(l.value=="^"){k=true}else{if(k&&l.type==g.NUMBER){k=false}else{if(!k&&l.type==g.NUMBER){p=false}else{if(l.type==g.OPERATOR&&"*/^()".indexOf(l.value)==-1){p=false}else{if(l.type==g.NAME&&s.value=="("){p=false}}}}}}}}if((l.type==g.NAME&&s.type==g.NAME)||(l.type==g.NUMBER&&s.type==g.NAME)||(l.type==g.NUMBER&&s.type==g.NUMBER)||(l.type==g.NUMBER&&s.value=="(")||(l.value==")"&&s.type==g.NAME)||(l.value==")"&&s.type==g.NUMBER)||(l.value==")"&&s.value=="(")){var r=(this.unit_mode&&!p&&(l.type==g.NUMBER||l.value==")")&&(s.type==g.NAME||(s.value=="("&&this.tokens.length>o+2&&this.tokens[o+2].type==g.NAME)));if(r){var v,u;if(s.type==g.NAME){v=s;u=o+1}else{u=o+2;v=this.tokens[u]}for(var n=0;n<this.constants.length;n++){if(v.value==this.constants[n]){r=false;break}}if(this.tokens.length>u+1&&this.tokens[u+1].value=="("){var t=["sqrt","abs","exp","factorial","diff","integrate","sum","product","limit","binomial","matrix","ln","log","log10"];for(var n=0;n<t.length;n++){if(v.value==t[n]){r=false;break}}}}var m;if(r){m=new g(g.OPERATOR,s.from,s.from,q.id,q);p=true}else{m=new g(g.OPERATOR,s.from,s.from,w.id,w)}this.tokens.splice(o+1,0,m)}}};e.prototype.parse=function(k){var j=new c(this.defs,k);this.tokens=j.tokenize();if(this.tokens.length==0){return null}if(this.accept_bad_syntax){this.addHiddenOperators()}this.token_nr=0;this.current_token=this.tokens[this.token_nr];this.advance();var i=this.expression(0);if(this.current_token!=null){throw new a("Expected the end",this.current_token.from)}return i};function g(i,m,l,j,k){this.type=i;this.from=m;this.to=l;this.value=j;this.op=k}g.UNKNOWN=0;g.NAME=1;g.NUMBER=2;g.OPERATOR=3;function c(i,j){this.defs=i;this.text=j}c.prototype.tokenize=function(){var r,j,m,q,l,k;j=0;r=this.text.charAt(j);l=[];main:while(r){q=j;if(r<=" "){j++;r=this.text.charAt(j);continue}if((r>="0"&&r<="9")||((r===f.DECIMAL_SIGN_1||r===f.DECIMAL_SIGN_2)&&(this.text.charAt(j+1)>="0"&&this.text.charAt(j+1)<="9"))){k="";if(r!==f.DECIMAL_SIGN_1&&r!==f.DECIMAL_SIGN_2){j++;k+=r;for(;;){r=this.text.charAt(j);if(r<"0"||r>"9"){break}j++;k+=r}}if(r===f.DECIMAL_SIGN_1||r===f.DECIMAL_SIGN_2){j++;k+=r;for(;;){r=this.text.charAt(j);if(r<"0"||r>"9"){break}j+=1;k+=r}}if(r==="e"||r==="E"){j++;k+=r;r=this.text.charAt(j);if(r==="-"||r==="+"){j++;k+=r;r=this.text.charAt(j)}if(r<"0"||r>"9"){throw new a("syntax error in number exponent",q,j)}do{j++;k+=r;r=this.text.charAt(j)}while(r>="0"&&r<="9")}var p=+k.replace(f.DECIMAL_SIGN_1,".").replace(f.DECIMAL_SIGN_2,".");if(isFinite(p)){l.push(new g(g.NUMBER,q,j-1,k,null));continue}else{throw new a("syntax error in number",q,j)}}for(m=0;m<this.defs.operators.length;m++){var o=this.defs.operators[m];if(this.text.substring(j,j+o.id.length)===o.id){j+=o.id.length;r=this.text.charAt(j);l.push(new g(g.OPERATOR,q,j-1,o.id,o));continue main}}if((r>="a"&&r<="z")||(r>="A"&&r<="Z")){k=r;j++;for(;;){r=this.text.charAt(j);if((r>="a"&&r<="z")||(r>="A"&&r<="Z")||(r>="0"&&r<="9")||r==="_"){k+=r;j++}else{break}}l.push(new g(g.NAME,q,j-1,k,null));continue}throw new a("unrecognized operator",q,j)}return l};var b=function(l){var m,k,n,i,j,p;m=l.ta;k=l.output_div;n=m.value;if(n!=l.oldtxt){l.oldtxt=n;while(k.firstChild!=null){k.removeChild(k.firstChild)}k.removeAttribute("title");if(n!=""){i=l.parser;try{p=i.parse(n);if(p!=null){var q=document.createElement("math");q.setAttribute("display","block");q.appendChild(p.toMathML());k.appendChild(q);MathJax.Hub.Queue(["Typeset",MathJax.Hub,k])}}catch(o){j="error: "+o;k.setAttribute("title",j);if(o instanceof a){k.appendChild(document.createTextNode(n.substring(0,o.from)));var r=document.createElement("span");r.appendChild(document.createTextNode(n.substring(o.from,o.to+1)));r.className="maxima-error";k.appendChild(r);if(o.to<n.length-1){k.appendChild(document.createTextNode(n.substring(o.to+1)))}}else{var s=document.createTextNode(j);k.appendChild(s)}}}}};window.addEventListener("load",function(o){var t=[];var p=document.getElementsByClassName("maxima");for(var m=0;m<p.length;m++){var n=p[m];var l=document.createElement("div");if(n.nextSibling){n.parentNode.insertBefore(l,n.nextSibling)}else{n.parentNode.appendChild(l)}var j=(n.getAttribute("data-accept_bad_syntax")==="true");var q=(n.getAttribute("data-unit_mode")==="true");var s=n.getAttribute("data-constants");if(s){s=s.split(/[\s,]+/)}var u="";t[m]={ta:n,output_div:l,oldtxt:u,parser:new e(j,q,s)};var k=function(i){return function(v){b(t[i])}};var r=k(m);if(n.value!=u){r()}n.addEventListener("change",r,false);n.addEventListener("keyup",r,false)}},false)}());